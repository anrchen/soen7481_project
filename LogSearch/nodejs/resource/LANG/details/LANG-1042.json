{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12746574","self":"https://issues.apache.org/jira/rest/api/2/issue/12746574","key":"LANG-1042","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12312322":null,"customfield_12310220":"2014-10-08T02:25:37.236+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Mar 01 14:48:06 UTC 2017","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_65717277846_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2016-11-06T15:48:56.816+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-1042/watchers","watchCount":4,"isWatching":false},"created":"2014-10-08T01:00:59.430+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[{"id":"12485840","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12485840","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12443837","key":"TEXT-43","self":"https://issues.apache.org/jira/rest/api/2/issue/12443837","fields":{"summary":"[XSS] StringEscapeUtils.escapeHtml() must escape ' chars to &#39; ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/4","description":"This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/reopened.png","name":"Reopened","id":"4","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"To Do"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype","name":"Improvement","subtask":false,"avatarId":21140}}}},{"id":"12399741","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12399741","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12750359","key":"LANG-1056","self":"https://issues.apache.org/jira/rest/api/2/issue/12750359","fields":{"summary":"StringEscapeUtils.unescapeHtml4 java.lang.IllegalArgumentException","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2017-03-01T14:48:06.140+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313203","id":"12313203","name":"lang.*"}],"timeoriginalestimate":null,"description":"The String Escape Utils should ensure that encoded data cannot escape from a string. However in HTML (starting with 1.0 and until the present), attribute values may be denoted by either single or double quotes. Therefore single quotes need to be escaped just as much as double quotes. \n\nFrom the standard: http://www.w3.org/TR/html4/intro/sgmltut.html#h-3.2.2\n\n{quote}\nBy default, SGML requires that all attribute values be delimited using either double quotation marks (ASCII decimal 34) or single quotation marks (ASCII decimal 39). Single quote marks can be included within the attribute value when the value is delimited by double quote marks, and vice versa. Authors may also use numeric character references to represent double quotes (&amp;#34\\;) and single quotes (&amp;#39\\;). For double quotes authors can also use the character entity reference &amp;quot;.\n{quote}\n\nNote that there have been several bugs in the wild in which string encoders use this library under the hood, and as a result fail to properly escape html attributes in which user input is stored:\n\n<div title='<%=user_data%>'>Howdy</div>\nif user_data = ' onclick='payload' ' \n\nthen an attacker can inject their code into the page even if the developer is using the string escape utils to escape the user string.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"StringEscapeUtils.escapeHtml() does not escape single quote","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsussland","name":"rsussland","key":"rsussland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Sussland","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsussland","name":"rsussland","key":"rsussland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Sussland","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14162960","id":"14162960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Hello Robert, \n\nI tried the following code\n\n{code:title=Sample.java|borderStyle=solid}\npublic class Sample {\n\n\tpublic static void main(String[] args) {\n\t\tString s = StringEscapeUtils.escapeHtml3(\"<div title='<%=user_data%>'>Howdy</div>\");\n\t\tSystem.out.println(s);\n\t}\n\t\n}\n{code}\n\nAnd it resulted in:\n\n{code}&lt;div title='&lt;%=user_data%&gt;'&gt;Howdy&lt;/div&gt;{code}\n\nUsing the escapeHtml4 method code gives similar output \n\n{code}&lt;div title='&lt;%=user_data%&gt;'&gt;Howdy&lt;/div&gt;{code}\n\nI didn't understand how to reproduce the issue, could you elaborate more or provide a test case? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-10-08T02:25:37.236+0000","updated":"2014-10-08T02:25:37.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14162966","id":"14162966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsussland","name":"rsussland","key":"rsussland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Sussland","active":true,"timeZone":"Etc/UTC"},"body":"Sorry for not being clear. Generally the escaping is done on user data that is quoted in the template -- you wouldn't escape the entire template. A simple example, without a template, would be\n\n{code:title=Bar.java|borderStyle=solid}\npublic class Sample {\n\n  public static void main(String[] args) {\n   \n    String taint = \"\\' onclick=\\'payload\\' \";\n\n    //now we should be able to safely assign to an html attribute\n    String escaped = StringEscapeUtils.escapeHtml3(taint);\n\n    String generatedHtml = \"<div title=\\' \" + escaped + \"\\'>Howdy</div>\";\n    System.out.println(generatedHtml); //'<div title=' ' onclick='alert(1)' ''>Howdy</div> is unsafe for html rendering\n  }\n}\n{code}\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmjones500","name":"dmjones500","key":"dmjones500","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dmjones500&avatarId=31601","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dmjones500&avatarId=31601","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dmjones500&avatarId=31601","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dmjones500&avatarId=31601"},"displayName":"Duncan Jones","active":true,"timeZone":"Europe/London"},"created":"2014-10-08T02:33:18.074+0000","updated":"2014-10-08T12:06:26.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14163426","id":"14163426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmjones500","name":"dmjones500","key":"dmjones500","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dmjones500&avatarId=31601","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dmjones500&avatarId=31601","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dmjones500&avatarId=31601","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dmjones500&avatarId=31601"},"displayName":"Duncan Jones","active":true,"timeZone":"Europe/London"},"body":"It's not really clear from the Javadocs what these methods are supposed to achieve. Clearly you were expecting the methods to render safe any user input that might be directly injected into other pieces of HTML. Looking at the code, it seems they only replace named entities (for XML this includes escaping {{'}} to {{&amp;apos;}}). At the very least, we should improve the Javadocs to make it clearer what is being escaped. \n\nIf our goal is to sanitise user input, then we should consider whether escaping single quotes is the only change to make. Any such change would break compatibility with earlier versions, so I'm not sure we could address this before 4.0 (unless we are convinced it's a bug, which is hard to prove since the docs are so vague).\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmjones500","name":"dmjones500","key":"dmjones500","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dmjones500&avatarId=31601","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dmjones500&avatarId=31601","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dmjones500&avatarId=31601","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dmjones500&avatarId=31601"},"displayName":"Duncan Jones","active":true,"timeZone":"Europe/London"},"created":"2014-10-08T12:34:46.064+0000","updated":"2014-10-08T12:34:46.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14164093","id":"14164093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsussland","name":"rsussland","key":"rsussland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Sussland","active":true,"timeZone":"Etc/UTC"},"body":"I was not expecting this data to be safe for arbitrary injection into html. String escaping has a well-defined meaning -- the output of this function should not be able break out of a string data context, because all characters that could be interpreted by the html parser as closing out the string data context are escaped.\n\nThis is exactly the string escaping behavior of other methods in this package, and what is commonly known as string escaping. \n\nc.f. https://tomcat.apache.org/taglibs/standard/apidocs/org/apache/taglibs/standard/util/EscapeXML.html\n\nIn terms of which characters need to be escaped, HTML as well as XML only allow string data in two places: attribute values and text nodes. Control characters that denote start/end of attribute values and text nodes are well-defined and finite: single/double quote for attribute values and brackets <, >.  This assumes that the template as a whole is valid html. \n\nAdditionally, the escaping symbol should also be escaped so that the method is a bijection and an unescaping method is possible. \n\nFinally, there is little value to a method that performs only html entity encoding -- unless you are building an html entity encoding demonstration method. The list of html entities was selected as a convenience so that html developers would not need to memorize ascii/unicode values for commonly used symbols such as e-accent, the less than sign, or the euro sign. The list of html entities is not the list of html control characters and is not relevant for an html string escaping method.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsussland","name":"rsussland","key":"rsussland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Sussland","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-08T20:19:57.658+0000","updated":"2014-10-08T20:19:57.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14165055","id":"14165055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmjones500","name":"dmjones500","key":"dmjones500","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dmjones500&avatarId=31601","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dmjones500&avatarId=31601","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dmjones500&avatarId=31601","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dmjones500&avatarId=31601"},"displayName":"Duncan Jones","active":true,"timeZone":"Europe/London"},"body":"bq. String escaping has a well-defined meaning – the output of this function should not be able break out of a string data context, because all characters that could be interpreted by the html parser as closing out the string data context are escaped.\n\nI don't think there's anything in the documentation that suggests the escaped data will be safe in a string data context. In fact, not describing the context is one of the many flaws in the current docs.\n\nBecause the current documentation is so woefully inadequate, I don't think we can't change any behaviour here under the rationale of \"it's a bug\". Therefore, I see we have two things to do:\n\n - Have a good think about the current functionality, then document it better so that people truly understand what it does and in which contexts it is useful (if any).\n\n - Decide if we should offer other escape methods that work in a wider range of contexts (including attribute values). If our goal with these methods is to prevent XSS attacks (amongst other things), then this should be stated clearly in any resulting method documentation.\n\nI don't entirely understand why these escaping methods are in Lang anyway, so I'm not in favour of extending them further. But that's just my 2c. I'm certainly in favour of extending the current Javadoc to ensure future users don't mistake what these methods are doing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmjones500","name":"dmjones500","key":"dmjones500","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dmjones500&avatarId=31601","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dmjones500&avatarId=31601","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dmjones500&avatarId=31601","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dmjones500&avatarId=31601"},"displayName":"Duncan Jones","active":true,"timeZone":"Europe/London"},"created":"2014-10-09T12:07:59.105+0000","updated":"2014-10-09T12:07:59.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14165080","id":"14165080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"Note that the escaping that needs to be done depends on the context of the string, i.e. where it is going to be used.\nAlso if a string is already partially escaped, it's very difficult to avoid accidentally escaping parts again.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2014-10-09T12:28:43.723+0000","updated":"2014-10-09T12:28:58.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14171218","id":"14171218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsussland","name":"rsussland","key":"rsussland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Sussland","active":true,"timeZone":"Etc/UTC"},"body":"Is there any chance we could deprecate this method? Regardless of what the original author was intending, they have now permeated the open source eco-system:\n\na github search shows 25K hits for StringEscapeUtils.escapeHtml. Looking at the results, users are expecting html string escaping in both attribute values and html nodes, with over 14K hits in JSPs where they are manually using this function to perform security encoding.\n\nhttps://github.com/search?utf8=%E2%9C%93&q=StringEscapeUtils.escapeHtml&type=Code&ref=searchresults\n\nWhat is saving the majority of these users is the (Java) convention that html attributes be double rather than single quoted. However, in Rails, attributes are single quoted by convention, and in JS-land you see a mix. I.e. we cannot rely on users being accidentally safe when using this function.\n\nThis function is also used to encode attribute values in Apache Struts. Spring MVC is not importing the package but effectively copied the code in HtmlUtils.java. \n\nThen Grails copied Spring's encoder (c.f. package org.grails.encoder.impl) which was also picked up by Wicket (wicket-util/src/main/java/org/apache/wicket/util/string/Entities.java). \n\nPoint being, you have the vast majority of Java MVC frameworks now improperly escaping html attributes and crucially relying on their double quote conventions for security. This is a concern when they take these same libraries re-use them.\n\nHere is the Play project, which for the most part uses the StringEscapeUtils methods, except for HTML encoding.\n\n{code}\n/api/src/main/scala/play/twirl/api/Formats.scala\n\n  def escape(text: String): Html = {\n    // Using our own algorithm here because commons lang escaping wasn't designed for protecting against XSS, and there\n    // don't seem to be any other good generic escaping tools out there.\n    val sb = new StringBuilder(text.length)\n    text.foreach {\n      case '<' => sb.append(\"&lt;\")\n      case '>' => sb.append(\"&gt;\")\n      case '\"' => sb.append(\"&quot;\")\n      case '\\'' => sb.append(\"&#x27;\")\n      case '&' => sb.append(\"&amp;\")\n      case c => sb += c\n    }\n    new Html(sb.toString)\n  }\n{code}\n\nIt would be nice if, instead of each developer needing to roll their own escaping library, they could rely on a common string escaping library. The StringEscapeUtils does this except for the html method -- what about deprecating this method and introducing a new one -- secureHtmlEscape --  that escapes <, >, ', \", and &?\n\nI understand that encoding is context sensitive. Generally you need to perform a sequence of encodings to match the sequence of browser parsings, but the sequence is built from HTML, JS, CSS, and URI encoding operations, so there is a need for a common definition of these. Then frameworks and toolkits can perform the proper contextual encoding using these functions.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsussland","name":"rsussland","key":"rsussland","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robert Sussland","active":true,"timeZone":"Etc/UTC"},"created":"2014-10-14T16:59:25.314+0000","updated":"2014-10-14T17:07:23.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14183879","id":"14183879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"> Duncan: Have a good think about the current functionality, then document it better so that people truly understand what it does and in which contexts it is useful (if any).\n\n+1 \n\n> Robert: what about deprecating this method and introducing a new one – secureHtmlEscape – that escapes <, >, ', \", and &?\n\n+0\n\nI think adding a secureHtmlEscape method could fix this issue, but I'm not sure if that wouldn't mean that we could have further variations or methods for XML, HTML or other formats.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-10-25T02:49:18.741+0000","updated":"2014-10-25T02:49:18.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/14183884","id":"14183884","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"LANG-1056 is related here to the vagueness of the Javadocs in the HTML escape methods.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-10-25T02:58:05.555+0000","updated":"2014-10-25T02:58:05.555+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12746574/comment/15890304","id":"15890304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garethdanielsmith","name":"garethdanielsmith","key":"garethdanielsmith","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garethdanielsmith&avatarId=23743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garethdanielsmith&avatarId=23743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garethdanielsmith&avatarId=23743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garethdanielsmith&avatarId=23743"},"displayName":"Gareth Daniel Smith","active":true,"timeZone":"Etc/UTC"},"body":"Note that Spring's HtmlUtils no longer seems to have this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garethdanielsmith","name":"garethdanielsmith","key":"garethdanielsmith","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garethdanielsmith&avatarId=23743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garethdanielsmith&avatarId=23743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garethdanielsmith&avatarId=23743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garethdanielsmith&avatarId=23743"},"displayName":"Gareth Daniel Smith","active":true,"timeZone":"Etc/UTC"},"created":"2017-03-01T14:48:06.140+0000","updated":"2017-03-01T14:48:06.140+0000"}],"maxResults":10,"total":10,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-1042/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i20wtj:"}}