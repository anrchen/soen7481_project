{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12761125","self":"https://issues.apache.org/jira/rest/api/2/issue/12761125","key":"LANG-1077","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/6","id":"6","description":"The problem isn't valid and it can't be fixed.","name":"Invalid"},"customfield_12312322":null,"customfield_12310220":"2014-12-12T12:49:46.505+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Dec 11 20:33:17 UTC 2015","customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_249345165_*|*_4_*:*_1_*:*_3544423_*|*_5_*:*_2_*:*_9769754087_*|*_6_*:*_1_*:*_21496875100","customfield_12312321":null,"resolutiondate":"2015-12-11T13:48:36.701+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-1077/watchers","watchCount":2,"isWatching":false},"created":"2014-12-11T18:23:17.956+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["patch"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326666","id":"12326666","description":"Bugfix release for 3.3.1","name":"3.3.2","archived":false,"released":true,"releaseDate":"2014-04-09"}],"issuelinks":[{"id":"12451570","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12451570","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12921028","key":"LANG-1193","self":"https://issues.apache.org/jira/rest/api/2/issue/12921028","fields":{"summary":"ordinalIndexOf(\"abc\", \"ab\", 1) gives incorrect answer of -1 (correct answer should be 0)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12467843","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12467843","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12973809","key":"LANG-1241","self":"https://issues.apache.org/jira/rest/api/2/issue/12973809","fields":{"summary":"StringUtils.ordinalIndexOf broken","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2016-05-29T15:35:08.587+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313203","id":"12313203","name":"lang.*"}],"timeoriginalestimate":null,"description":"{code:title= org.apache.commons.lang3.StringUtils.java|borderStyle=solid}\n        int found = 0;\n        int index = lastIndex ? str.length() : INDEX_NOT_FOUND;\n        do {\n            if (lastIndex) {\n                index = CharSequenceUtils.lastIndexOf(str, searchStr, index - 1);\n            } else {\n                index = CharSequenceUtils.indexOf(str, searchStr, index + 1);\n            }\n            if (index < 0) {\n                return index;\n            }\n            found++;\n        } while (found < ordinal);\n{code}\n\nShould it be:\n\n{code:title= org.apache.commons.lang3.StringUtils.java|borderStyle=solid}\n        private static int ordinalIndexOf(final CharSequence str, final CharSequence searchStr, final int ordinal, final boolean lastIndex) {\n        //        if (str == null || searchStr == null || ordinal <= 0) {\n        //            return INDEX_NOT_FOUND;\n        //        }\n        //        if (searchStr.length() == 0) {\n        //            return lastIndex ? str.length() : 0;\n        //        }\n        //        int found = 0;\n        //        int index = lastIndex ? str.length() : INDEX_NOT_FOUND;\n        //        do {\n        //            if (lastIndex) {\n        //                index = CharSequenceUtils.lastIndexOf(str, searchStr, index - 1);\n        //            } else {\n        //                index = CharSequenceUtils.indexOf(str, searchStr, index + 1);\n        //            }\n        //            if (index < 0) {\n        //                return index;\n        //            }\n        //            found++;\n        //        } while (found < ordinal);\n        //        return index;\n\n        if (str == null || searchStr == null || ordinal <= 0) {\n            return INDEX_NOT_FOUND;\n        }\n\n        if (searchStr.length() == 0) {\n            return lastIndex ? str.length() : 0;\n        }\n\n        final int searchStrLen = searchStr.length();\n        int index = lastIndex ? str.length() : 0;\n\n        for (int found = 0; index >= 0;) {\n            if (lastIndex) {\n                index = CharSequenceUtils.lastIndexOf(str, searchStr, index);\n            } else {\n                index = CharSequenceUtils.indexOf(str, searchStr, index);\n            }\n\n            if (index < 0) {\n                return INDEX_NOT_FOUND;\n            }\n\n            if (++found >= ordinal) {\n                break;\n            }\n\n            index = lastIndex ? index - searchStrLen : index + searchStrLen;\n        }\n\n        return index;\n    }\n{code}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12686843","id":"12686843","filename":"LANG-1077.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-12-12T12:50:45.144+0000","size":1538,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12686843/LANG-1077.patch"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"summary":"[PATCH] StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) should return 2","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14244073","id":"14244073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Hi Haiyang!\n\nYour code does make sense, and I've made a patch with it (hope you don't mind) for others to take a look and experiment with it. \n\nI thought about committing it to the trunk, but I got confused with the title of the issue.\n\nRunning the code as is in the trunk, {{StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2)}} returns *1*. After applying the patch with your code, {{StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2)}} returns *3*... so it is still != 2, and I think that's the expected behavior.\n\nDo you reckon that the expected result should be indeed *3*? \n\nThanks!\nBruno","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-12-12T12:49:46.505+0000","updated":"2014-12-12T12:49:46.505+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14244075","id":"14244075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Patch with Haiyang Li code and a unit test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-12-12T12:50:45.151+0000","updated":"2014-12-12T12:50:45.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14244545","id":"14244545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"HI, Bruno\nThe code i pasted is incorrect. I changed it now. please have a look. \nPreviously I just read the code but didn't test it with the modification.\n\nthank you for testing it out!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-12T18:15:03.339+0000","updated":"2014-12-12T18:15:03.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14244613","id":"14244613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Hello Haiyang!\n\nNo, I thank you for filing the issue and taking your time to provide some code. I never used the orginalIndexOf, so I thought it was a good chance to learn it too :-)\n\nI *think* your previous code was right. Looking at the current implementation, it sems to always return the first occurrence of the needle (searchStr), *after* the given offset (ordinal) in the haystack (str).\n\nI updated my local copy with your updated code, and it broke existing tests. \n\nWhat do you think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-12-12T18:57:18.898+0000","updated":"2014-12-12T18:57:18.898+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14244670","id":"14244670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"en... It's my bad. updated it again. I downloaded the source code and made the change and tested it this time.\n(BTW, I a newcomer and we have a project which uses Commons Lang a lot. that's why i'm looking into code. Commons Lang provides a lot of useful APIs and help me a lot. appreciate the work you guys have done. Good job!)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-12T19:39:25.876+0000","updated":"2014-12-12T19:40:16.712+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14244691","id":"14244691","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"So are you +1 for we applying the existing patch, with your original code? If so I will commit the patch to the trunk tonight.\n\nAlso, if you agree, I would like to update the title from \"StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) != 2 in StringUtils\" to \"StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) != *3* in StringUtils\" just to avoid any confusion in the future.\n\n> (BTW, I a newcomer and we have a project which uses Commons Lang a lot. that's why i'm looking into code. Commons Lang provides a lot of useful APIs and help me a lot. appreciate the work you guys have done. Good job!)\n\nThat's a great initiative Haiyang. We are a group of volunteers, and the feedback and contributions like yours are very important. Feel free to report other issues. If you feel like, you can also write patches (tests are always welcome :-D ), this way your code can get merged and released to all users (how cool is that?).\n\nAll the best,\nBruno","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-12-12T19:55:27.254+0000","updated":"2014-12-12T19:55:27.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14244697","id":"14244697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"yes. i will be glad to see the code is to be merged into trunk.\n\nAnd I will continue to review the code in my spare time and report any issues I find.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2014-12-12T20:04:03.801+0000","updated":"2014-12-12T20:04:03.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14245100","id":"14245100","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Committed in revision r1645101.\n\nThank you very much for your contribution Haiyang. \n\nBruno","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-12-13T02:01:01.783+0000","updated":"2014-12-13T02:01:01.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/14245949","id":"14245949","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Patch with user contribution applied to trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-12-14T15:39:03.111+0000","updated":"2014-12-14T15:39:03.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15052710","id":"15052710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"The patch that was applied was wrong.\nThe problem is that one cannot subtract the search length each time, unless one allows for this in the initial index. \n\nThis is why the initial index is set to str.len (i.e. max index +1) or -1 (min index -1); then the first time through the loop, the original code starts at the end or start respectively.\n\nThe patched code now fails to start searching at the beginning when the search string len > 1, see LANG-1193","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2015-12-11T12:49:32.255+0000","updated":"2015-12-11T12:49:32.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15052734","id":"15052734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"On further reflection, I think the original bug report was wrong, and the original code is correct.\n\nThe original code steps through the search target one char at a time, so I think the behaviour should be:\n\nStringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 1) => 0 // matches \"aa\"\nStringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) => 1 // matches \".aa\"\n\nHowever if overlapping matches are not allowed, I would expect:\n\nStringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) => 2 // matches \"..aa\"\n\nI have no idea why it was ever expected that the result should be \"3\", unless it was thought that the index started at 1.\n\nPerhaps the OP expected overlapping matches to be disallowed.\nHowever there is  no indication that this was ever intended.\n\nThe fix needs to be reverted, and the Javadoc updated to make it clear that overlapping matches are allowed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2015-12-11T13:21:20.054+0000","updated":"2015-12-11T13:21:20.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15052778","id":"15052778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"Revert LANG-1077\n\nProject: http://git-wip-us.apache.org/repos/asf/commons-lang/repo\nCommit: http://git-wip-us.apache.org/repos/asf/commons-lang/commit/d75fe46b\nTree: http://git-wip-us.apache.org/repos/asf/commons-lang/tree/d75fe46b\nDiff: http://git-wip-us.apache.org/repos/asf/commons-lang/diff/d75fe46b\n\nBranch: refs/heads/master\nCommit: d75fe46b8f1b0d5c27887052ee4714d6a9c7ea4b\nParents: 15e1ea2\nAuthor: Sebb <sebb@apache.org>\nAuthored: Fri Dec 11 13:41:22 2015 +0000\nCommitter: Sebb <sebb@apache.org>\nCommitted: Fri Dec 11 13:41:22 2015 +0000\n\n----------------------------------------------------------------------\n src/changes/changes.xml                            |  2 +-\n .../java/org/apache/commons/lang3/StringUtils.java | 15 ++++++++++++---\n .../lang3/StringUtilsEqualsIndexOfTest.java        | 17 +++++++++++++++--\n 3 files changed, 28 insertions(+), 6 deletions(-)\n----------------------------------------------------------------------\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2015-12-11T13:48:36.722+0000","updated":"2015-12-11T13:48:36.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053018","id":"15053018","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"Sebb, \nThe original bug is: StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) should return 2. somehow title was changed:  \n\"StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) != 2 in StringUtils\" to \"StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) != 3\nAnd wrong patch was merged into trunk.\nThe right code should be:\n--------------------------------------------------------------------------------------------------------------\n    private static int ordinalIndexOf(final CharSequence str, final CharSequence searchStr, final int ordinal, final boolean lastIndex) {\n        if (str == null || searchStr == null || ordinal <= 0) {\n            return INDEX_NOT_FOUND;\n        }\n\n        if (searchStr.length() == 0) {\n            return lastIndex ? str.length() : 0;\n        }\n\n        final int searchStrLen = searchStr.length();\n        int index = lastIndex ? str.length() : 0;\n\n        for (int found = 0; index >= 0;) {\n            if (lastIndex) {\n                index = CharSequenceUtils.lastIndexOf(str, searchStr, index);\n            } else {\n                index = CharSequenceUtils.indexOf(str, searchStr, index);\n            }\n\n            if (index < 0) {\n                return INDEX_NOT_FOUND;\n            }\n\n            if (++found >= ordinal) {\n                break;\n            }\n\n            index = lastIndex ? index - searchStrLen : index + searchStrLen;\n        }\n\n        return index;\n    }\n--------------------------------------------------------------------------------------------------------------\n\nplease look into the original code.\nThis is a valid bug. It's can't be correct by just updating java doc. because it may confuse people.\n\nBTW, the bug was reported on 12/11/2014,  today is 12/11/15","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-11T16:58:58.558+0000","updated":"2015-12-11T17:12:56.186+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053099","id":"15053099","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"bq. The original bug is: StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) should return 2.\n\nSorry, but that is wrong.\n\nThe code returns *all* matches, so the first match is \"aa....\", i.e. index 0.\nThe second match is \".aa...\", i.e. index 1.\nThird match would be \"..aa..\", i.e. index 2.\netc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2015-12-11T17:50:18.647+0000","updated":"2015-12-11T17:50:18.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053124","id":"15053124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"Sebb, \nIt doesn't make sense. take a few minutes to think about the definition/contract of \"indexOf\", and consider \"searchStr\" as whole object, no matter it's \"aa\", or \"ab\".\n\nOr, try to think about the question:\nThere is one string A: \"aaaaaa\", string B: \"aa\", how many B in A and return the index of each?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-11T18:07:18.860+0000","updated":"2015-12-11T18:23:31.928+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053159","id":"15053159","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"bq. There is one string A: \"aaaaaa\", string B: \"aa\", how many B in A and return the index of each?\n\nThere are 5 B in A, indexes 0,1,2,3,4\n\nRemember that overlapping matches are allowed, and indexes start at 0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2015-12-11T18:31:54.630+0000","updated":"2015-12-11T18:31:54.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053183","id":"15053183","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"There are ONLY 3 B in A. \nConsider the case: A: \"ababab\", B: \"ab\", or A:\"aaaaaa\", B: \"aa\". in different scenarios, the expected result should be same, not matter what in A and B. \nYou are assuming the programmers always know what in B or have to check what in B, and remember what they should NOT when call this method.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-11T18:44:21.173+0000","updated":"2015-12-11T18:44:21.173+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053390","id":"15053390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"The difference with \"ab\" is that it cannot ever match overlapping sections of the string.\n\nHowever consider A: \"ababab\" B: \"aba\". B matches at index 0, it also matches at index 2.\nSimilarly for B: \"abab\"\n\nAs I already wrote, the method allows overlapping matches.\nIt did so until version 3.4 when the code was changed, breaking it in the process (e.g. JIRA-1193)\n\nI agree that the Javadoc was not precise, as it did not specify whether or not overlapping matches should be allowed.\nThe Javadoc has now been clarified to agree with the original behaviour.\n\nIt would of course be possible to have a different strategy whereby overlapping matches were not allowed, but that would be a change from the original behaviour, so would need a new method in order to avoid breaking the code for users that rely on the original behaviour.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2015-12-11T19:15:20.707+0000","updated":"2015-12-11T19:15:20.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053411","id":"15053411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"It's 19:18 at London?  how are you doing today? It's Friday. Here is 11:18 at CA.\n\nJIRA-1193 is broken by wrong patch. the right code will work fine and fix JIRA-1193.\nYou're keeping talking \"overlapping matches\". This is a general XXXIndexOf(...), not a match method...\nThe doc looks good to me. what wrong is the behavior/code in the method. Even the java doc is updated with \"overlapping matches  is allowed\". People may NOT notice it, or remember it, or even don't read the doc. It could bring bugs by unexpected result even doc is updated.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-11T19:27:36.432+0000","updated":"2015-12-11T19:27:36.432+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053437","id":"15053437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tn","name":"tn","key":"tn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Neidhart","active":true,"timeZone":"Europe/Berlin"},"body":"This code exists since a long time and looking at the implementation it is clear what it does and what its intention is: repeatedly execute indexOf with a start index of +1 compared to the last match. There are even suggestions on stackoverflow to use this method for exactly that use-case.\n\nWhat you are facing is a corner-case that was not described in the javadoc and thus it might create confusion for a user. So the right thing to do is what sebb did: revert the fix to the previous, working version and update the javadoc to document the corner case. Contrary to your opinion that this might introduce bugs, it is quite the opposite, your fix will introduce bugs as people relied on the previous version for a long time already.\n\nIf there is a need for a method that does not handle overlaps, then this should be a new feature request. The method could have an additional flag to indicate how it handles overlaps.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tn","name":"tn","key":"tn","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Neidhart","active":true,"timeZone":"Europe/Berlin"},"created":"2015-12-11T19:45:47.409+0000","updated":"2015-12-11T19:45:47.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053470","id":"15053470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"I agree that had the patch been 'better' it would not have caused JIRA-1193 to be raised. In fact I was originally going to try to fix it accordingly.\n\nHowever, I looked further into it, and noticed that fixing the behaviour according to your original issue was not a good idea, as it would have changed the existing behaviour.\nThe code was added to LANG in version 2.1 about 12 years ago, and the behaviour did not change until 3.4 which broke it.\n\nAlthough the behaviour is not what you expect, it is consistent with the original Javadoc.\nFurthermore the behaviour has been the same for multiple releases, so changing the behaviour now would potentially break existing applications.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2015-12-11T19:57:42.562+0000","updated":"2015-12-11T19:57:42.562+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053486","id":"15053486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"If as you said: \"There are even suggestions on stackoverflow to use this method for exactly that use-case\", (I think that use-case you referred is: StringUtils.ordinalIndexOf(\"aaaaaa\", \"aa\", 2) should return 1), I agree to roll back the change to previous version.\n\nOn the other side: \"This code exists since a long time and looking at the implementation it is clear what it does and what its intention is: ...\"\nHow long it exists doesn't mean how right it is. Definitely it does incorrectly what it's supposed to do, from my aspect.\n\nBy the way, again, JIRA-1193 in 3.4 was broken by the wrong patch/code, not by this ticket","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-11T20:03:42.683+0000","updated":"2015-12-11T20:07:16.428+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053494","id":"15053494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"OK, basically, I think all of us agree: \"Furthermore the behaviour has been the same for multiple releases, so changing the behaviour now would potentially break existing applications.\".\nThe discussion can be moved to how to improve this method.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-11T20:11:57.504+0000","updated":"2015-12-11T20:11:57.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12761125/comment/15053521","id":"15053521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"body":"After think it about couple of minutes, I have another question: What're the general policies to fix bug/improve the code if it is not reported as bug in previous versions?\n\nAgain, I can understand and agree to roll back the changes to previous version for this case since it has been there for a long time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lihy70","name":"lihy70","key":"lihy70","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"haiyang li","active":true,"timeZone":"America/Los_Angeles"},"created":"2015-12-11T20:33:17.455+0000","updated":"2015-12-11T20:33:17.455+0000"}],"maxResults":24,"total":24,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-1077/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i23btr:"}}