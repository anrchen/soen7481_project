{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12461956","self":"https://issues.apache.org/jira/rest/api/2/issue/12461956","key":"LANG-617","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311714","id":"12311714","description":"JDK 1.5 focused version of Lang","name":"3.0","archived":true,"released":true,"releaseDate":"2011-07-19"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-04-14T07:48:04.277+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Sep 17 05:11:59 UTC 2010","customfield_12310420":"147449","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_13527991163_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2010-09-17T05:12:00.008+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-617/watchers","watchCount":1,"isWatching":false},"created":"2010-04-13T15:25:28.845+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312481","id":"12312481","description":"Bugfix release of the Lang1 codebase","name":"2.4","archived":true,"released":true,"releaseDate":"2008-03-18"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-09-17T05:11:59.997+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313203","id":"12313203","name":"lang.*"}],"timeoriginalestimate":null,"description":"Supplementary characters in UTF-16 are those whose code points are above 0xffff, that is, require more than 1 Java char to be encoded, as explained here: http://java.sun.com/developer/technicalArticles/Intl/Supplementary/\n\nCurrently, StringEscapeUtils.escapeXML() isn't aware of this coding scheme and treats each char as one character, which is not always right.\n\nA possible solution in class Entities would be:\n\n    public void escape(Writer writer, String str) throws IOException {\n        int len = str.length();\n        for (int i = 0; i < len; i++) {\n            int code = str.codePointAt(i);\n            String entityName = this.entityName(code);\n            if (entityName != null) {\n                writer.write('&');\n                writer.write(entityName);\n                writer.write(';');\n            } else if (code > 0x7F) {\n                    writer.write(\"&#\");\n                    writer.write(code);\n                    writer.write(';');\n            } else {\n                    writer.write((char) code);\n            }\n\n            if (code > 0xffff) {\n                    i++;\n            }\n        }\n    }\n\nBesides fixing escapeXML(), this will also affect HTML escaping functions. I guess that's a good thing, but please remember I have only tested escapeXML().\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12441714","id":"12441714","filename":"ASF.LICENSE.NOT.GRANTED--utf8-fragment.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dav.garcia","name":"dav.garcia","key":"dav.garcia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Garcia","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-14T11:11:35.130+0000","size":56,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12441714/ASF.LICENSE.NOT.GRANTED--utf8-fragment.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12441715","id":"12441715","filename":"ASF.LICENSE.NOT.GRANTED--xml-escaped-fragment.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dav.garcia","name":"dav.garcia","key":"dav.garcia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Garcia","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-14T11:11:35.152+0000","size":86,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12441715/ASF.LICENSE.NOT.GRANTED--xml-escaped-fragment.txt"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"74701","customfield_12312823":null,"summary":"StringEscapeUtils.escapeXML() can't process UTF-16 supplementary characters","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dav.garcia","name":"dav.garcia","key":"dav.garcia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Garcia","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dav.garcia","name":"dav.garcia","key":"dav.garcia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Garcia","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12461956/comment/12856784","id":"12856784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"In 3.0 the code has changed a fair amount. These will no longer escape for escapeXML and escapeHTML, but it's easy to turn the feature back on. The code is also now codepoint based, but I need to get a good unit test in for supplementary characters to decide what the code should actually do:\n\nhttp://svn.apache.org/repos/asf/commons/proper/lang/trunk/src/main/java/org/apache/commons/lang3/text/translate/UnicodeEscaper.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-04-14T07:48:04.277+0000","updated":"2010-04-14T07:48:04.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12461956/comment/12856840","id":"12856840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dav.garcia","name":"dav.garcia","key":"dav.garcia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Garcia","active":true,"timeZone":"Etc/UTC"},"body":"I am attaching two files with a very simple test case:\n- utf8-fragment.txt\n  Contains an UTF-8 encoded string with a few BMP (Basic Multilingual Plane) characters and 6 non-BMP characters (the ones causing trouble).\n- xml-escaped-fragment.txt\n  Contains the expected XML-escaped string.\n\nI hope you find it useful.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dav.garcia","name":"dav.garcia","key":"dav.garcia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Garcia","active":true,"timeZone":"Etc/UTC"},"created":"2010-04-14T11:11:15.665+0000","updated":"2010-04-14T11:11:15.665+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12461956/comment/12881096","id":"12881096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"I tested with 10C22, broken down into supplementary \\uD803\\uDC22 and the new code seems happy for the numeric entity escaping. \n\nUnescaping will need some work, so I will leave this open. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-22T06:32:54.339+0000","updated":"2010-06-22T06:32:54.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12461956/comment/12881097","id":"12881097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"Change made to the NumericEntityUnescaper so &#68642; escapes to \\uD803\\uDC22.\n\nVery interested in how the current trunk works for you. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-06-22T06:36:21.982+0000","updated":"2010-06-22T06:36:21.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12461956/comment/12910453","id":"12910453","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"Marking this as closed. Feel free to reopen if you find the current codebase is still problematic David. Things seem good with the data you provided (many thanks for that by the way).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2010-09-17T05:11:59.973+0000","updated":"2010-09-17T05:11:59.973+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-617/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d5pj:"}}