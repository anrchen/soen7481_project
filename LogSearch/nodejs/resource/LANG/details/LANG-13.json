{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12341159","self":"https://issues.apache.org/jira/rest/api/2/issue/12341159","key":"LANG-13","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311701","id":"12311701","description":"","name":"2.1","archived":true,"released":true,"releaseDate":"2005-06-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2004-07-05T04:20:09.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Wed Apr 26 13:10:57 UTC 2006","customfield_12310420":"34133","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":"2009-12-16T08:51:53.773+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-13/watchers","watchCount":0,"isWatching":false},"created":"2003-12-16T18:44:27.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311706","id":"12311706","description":"","name":"2.0","archived":true,"released":true,"releaseDate":"2003-09-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-12-16T08:51:53.773+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313196","id":"12313196","name":"lang.time.*"}],"timeoriginalestimate":null,"description":"Try this using a Central European TimeZone:\n\nimport java.util.Calendar;\nimport org.apache.commons.lang.time.DateUtils;\n\nCalendar cal = Calendar.getInstance();\ncal.set(Calendar.MONTH, Calendar.MARCH);\ncal.set(Calendar.YEAR, 2003);\ncal.set(Calendar.DAY_OF_MONTH, 30);\ncal.set(Calendar.HOUR_OF_DAY, 5);\ncal.set(Calendar.MINUTE, 0);\ncal.set(Calendar.SECOND, 0);\nDate date_20030330 = cal.getTime();\n\nDate expDate = DateUtils.truncate(date_20030330, Calendar.DATE);\nSystem.out.println(expDate.toString());\n\n-> Sat Mar 29 23:00:00 MET 2003 instead of Sun Mar 30 00:00:00 MET 2003\n\nIf the calendar instance represents a date AFTER the daylight savings time\nswitch and will be truncated to a time BEFORE the daylight savings time switch,\nthen the resulting date is wrong. (Daylight savings time was Sun Mar 30 02:00:00\nresetting to 01:00.00.) Might also happen when rounding up dates over the\ndaylight savings time switch...","customfield_10010":25560.0,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"74961","customfield_12312823":null,"summary":"[lang] DateUtils.truncate() is off by one hour when using a date in DST switch 'zone'","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joachim.hagger%40netcetera.ch","name":"joachim.hagger@netcetera.ch","key":"joachim.hagger@netcetera.ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joachim Hagger","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joachim.hagger%40netcetera.ch","name":"joachim.hagger@netcetera.ch","key":"joachim.hagger@netcetera.ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joachim Hagger","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Operating System: All\nPlatform: All","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12341159/comment/12405662","id":"12405662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevencaswell%40apache.org","name":"stevencaswell@apache.org","key":"stevencaswell@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Caswell","active":true,"timeZone":"Etc/UTC"},"body":"The appears to be fixable with a minor change to the DateUtils.modify method,\nreplacing the val.add call with a val.set call, doing the calculation external\nto the Calendar instance. For some reason, the Calendar.add method subtracts an\nadditional hour in the particular test scenario mentioned in the bug report, but\ndoesn't with other timezones I tested (such as US/Eastern). So I think the\neasiest fix is to do the calculation in our code.\n\nI have changed the DateUtils.modify method and the existing tests pass. I've\nwritten one test to verify the fix works with the above scenario, and I plan to\nwrite some additional tests for rounding.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevencaswell%40apache.org","name":"stevencaswell@apache.org","key":"stevencaswell@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Caswell","active":true,"timeZone":"Etc/UTC"},"created":"2004-07-05T04:20:09.000+0000","updated":"2004-07-05T04:20:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12341159/comment/12405663","id":"12405663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevencaswell%40apache.org","name":"stevencaswell@apache.org","key":"stevencaswell@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Caswell","active":true,"timeZone":"Etc/UTC"},"body":"After some more testing, the light bulb came on as to why the Calendar.add\nmethod seemed to be overshooting the correct date and subtracting 6 hours\ninstead of five. This is probably a \"duh\" for most everyone else, but it took me\na few minutes to see it. The DateUtils.modify method, which does the gruntwork\nof the round and truncate methods, was subtracting the number of hours from the\ndate being rounded/truncated. In this paricular case, it was subtracting 5 hours\nto get from 05:00 to 00:00. However, since the scenario happened to cause this\nacross a DST enablement, Calendar.add was treating the time between 02:00 and\n03:00 as non-existing, so subtracting 5 hours from 05:00 was giving 23:00 on the\nprevious day, which is technically correct. But for a rounding/truncation\nmethod, this is not appropriate, so my earlier solution of calculating the\ndesired hour value and using set does appear to be appropriate.\n\nNote that I did a few tests on rounding across the 02:00/03:00 barrier, and the\nrounding also \"ignores\" the missing hour. So for example, rounding 01:40 gives\n03:00, and rounding 02:40 give 04:00, which IMHO are both correct, since the\n02:00-03:00 hour does not exist.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevencaswell%40apache.org","name":"stevencaswell@apache.org","key":"stevencaswell@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Caswell","active":true,"timeZone":"Etc/UTC"},"created":"2004-07-05T04:34:05.000+0000","updated":"2004-07-05T04:34:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12341159/comment/12405664","id":"12405664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevencaswell%40apache.org","name":"stevencaswell@apache.org","key":"stevencaswell@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Caswell","active":true,"timeZone":"Etc/UTC"},"body":"The truncate/round logic was adding a negative value to the current hours (using\nCalendar.add) to move the hours back to zero. When this is done across the\nbeginning of daylight saving time, it has the affect of moving to 23:00 of the\nprevious day, because the hour skipped when daylight saving time doesn't exist.\nFor example, if daylight saving time begins at 02:00, and -5 is added to 05:00,\nthe result is 23:00 of yesterday, because the hour between 02:00 and 03:00\ndoesn't exist. The fix was to do the calculation in the truncate/round code, and\nuse Calendar.set to set the new hour value.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevencaswell%40apache.org","name":"stevencaswell@apache.org","key":"stevencaswell@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Caswell","active":true,"timeZone":"Etc/UTC"},"created":"2004-07-12T00:04:48.000+0000","updated":"2004-07-12T00:04:48.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12341159/comment/12405665","id":"12405665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apa3a%40yahoo.com","name":"apa3a@yahoo.com","key":"apa3a@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andriy Palamarchuk","active":true,"timeZone":"Etc/UTC"},"body":"Just hit this bug using 2.0.\nThis is what happens to those who work on Sundays :-).\nVery delighted that fix exists. I'm about to give my app to the client and don't\nwant to use current CVS or custom-patched library. Found a workaround:\n\nDateUtils.truncate(date, Calendar.DATE)\n\nuse:\n\nDateUtils.round(\n        DateUtils.truncate(date, Calendar.DATE),\n        Calendar.DATE)\n\nCall to round eliminates any 1-hour discrepancy which may exist.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=apa3a%40yahoo.com","name":"apa3a@yahoo.com","key":"apa3a@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andriy Palamarchuk","active":true,"timeZone":"Etc/UTC"},"created":"2005-04-04T04:20:12.000+0000","updated":"2005-04-04T04:20:12.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12341159/comment/12405666","id":"12405666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"2.1 released, closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2006-04-26T13:10:57.000+0000","updated":"2006-04-26T13:10:57.000+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-13/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d7bb:"}}