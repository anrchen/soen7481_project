{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12340483","self":"https://issues.apache.org/jira/rest/api/2/issue/12340483","key":"LANG-20","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311706","id":"12311706","description":"","name":"2.0","archived":true,"released":true,"releaseDate":"2003-09-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2003-01-20T02:51:15.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 20 03:10:04 UTC 2003","customfield_12310420":"34102","customfield_12312320":null,"customfield_12310222":null,"customfield_12312321":null,"resolutiondate":"2006-05-16T12:44:16.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-20/watchers","watchCount":0,"isWatching":false},"created":"2003-01-11T13:27:37.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311706","id":"12311706","description":"","name":"2.0","archived":true,"released":true,"releaseDate":"2003-09-02"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-05-16T12:44:16.000+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"ToStringBuilder.reflectionToString() enters an infinite loop when used with the \nfollowing example:\n\n/////////////////////////////\npublic class Outer {\n  Inner inner = new Inner();\n  class Inner {\n    public String toString() {\n      return ToStringBuilder.reflectionToString(this);\n    }\n  }\n  public String toString() {\n    return ToStringBuilder.reflectionToString(this);\n  }\n  public static void main(String[] args) {\n    Outer outer = new Outer();\n    System.out.println(outer);\n  }\n}\n/////////////////////////////\n\nThe reason is that the two classes refer to each other via the explicit field \ninner and the implicit field Outer.this. \n\nThe bug can be resolved by skipping the implicit fields. Is there any good \nreason for printing those anyway?\n\nI am not sure what is the best way to detect if a field is an implicit field. \nBut I patched the code myself in a way that seemed to work:\n\n/////////////////////////////\npublic static String reflectionToString(Object object, ToStringStyle style, \n        boolean outputTransients) {\n    if (object == null) {\n        throw new IllegalArgumentException(\"The object must not be null\");\n    }\n    if (style == null) {\n        style = getDefaultStyle();\n    }\n    Field[] fields = object.getClass().getDeclaredFields();\n    Field.setAccessible(fields, true);\n    ToStringBuilder builder = new ToStringBuilder(object, style);\n    for (int i = 0; i < fields.length; ++i) {\n        Field f = fields[i];\n        if (!f.getName().startsWith(\"this$\")) {\n          if (outputTransients || !Modifier.isTransient(f.getModifiers())) {\n              if (!Modifier.isStatic(f.getModifiers())) {\n                  try {\n                      builder.append(f.getName(), f.get(object));\n                      \n                  } catch (IllegalAccessException ex) {\n                      //this can't happen. Would get a Security exception \ninstead\n                      //throw a runtime exception in case the impossible \nhappens.\n                      throw new InternalError(\"Unexpected \nIllegalAccessException\");\n                  }\n              }\n          }\n        }\n    }\n    return builder.toString();\n}\n/////////////////////////////\n\nNotice the extra if statement that tests for field names starting with \"this$\". \nI don't know if this is guaranteed to work always, though.","customfield_10010":15986.0,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"74954","customfield_12312823":null,"summary":"Infinite loop in ToStringBuilder.reflectionToString for inner classes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=per%40velschow.com","name":"per@velschow.com","key":"per@velschow.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Per Velschow","active":true,"timeZone":"Europe/Copenhagen"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=per%40velschow.com","name":"per@velschow.com","key":"per@velschow.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Per Velschow","active":true,"timeZone":"Europe/Copenhagen"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Operating System: All\nPlatform: PC","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12340483/comment/12403426","id":"12403426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scolebourne%40joda.org","name":"scolebourne@joda.org","key":"scolebourne@joda.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Colebourne","active":true,"timeZone":"Etc/UTC"},"body":"Change made which should deal with this situation.\nThanks for the report and test.\nStephen","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scolebourne%40joda.org","name":"scolebourne@joda.org","key":"scolebourne@joda.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Colebourne","active":true,"timeZone":"Etc/UTC"},"created":"2003-01-20T02:51:15.000+0000","updated":"2003-01-20T02:51:15.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12340483/comment/12403427","id":"12403427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=per%40velschow.com","name":"per@velschow.com","key":"per@velschow.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Per Velschow","active":true,"timeZone":"Europe/Copenhagen"},"body":"I just checked the changes in CVS. If I read the code correctly, it will now \ndiscard any field name containing a '$' character. This may be too restrictive \nsince '$' is a legal identifier part AFAIK.\n\nAlso, I have thought a bit more about the problem. It is actually a more \ngeneral problem than the one I reported. Inner classes are not the only way you \ncould have mutually recursive data structures. So perhaps we should think of a \nmore general way of preventing this infinite loop. I have not made any solution \nyet, but I think it might be solved using a Set of references to already \ntraversed instances and then avoid traversing an instance if it has already \nbeen traversed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=per%40velschow.com","name":"per@velschow.com","key":"per@velschow.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Per Velschow","active":true,"timeZone":"Europe/Copenhagen"},"created":"2003-01-20T03:10:04.000+0000","updated":"2003-01-20T03:10:04.000+0000"}],"maxResults":2,"total":2,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-20/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d79r:"}}