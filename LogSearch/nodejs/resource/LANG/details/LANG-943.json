{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12687374","self":"https://issues.apache.org/jira/rest/api/2/issue/12687374","key":"LANG-943","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325851","id":"12325851","description":"Bug fixes and and new features including: DifferenceBuilder, ClassPathUtils, RandomUtils and Jaro-Winkler String distance metric","name":"3.3","archived":false,"released":true,"releaseDate":"2014-03-04"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-01-12T12:45:02.616+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Jan 20 18:45:56 UTC 2014","customfield_12310420":"366373","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1279302693_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2014-01-20T18:45:56.283+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-943/watchers","watchCount":2,"isWatching":false},"created":"2014-01-05T23:24:13.623+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["test-fail","timezone"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317550","id":"12317550","description":"November release from 3.x","name":"3.1","archived":false,"released":true,"releaseDate":"2011-11-14"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317952","id":"12317952","description":"Bug fixes and new features, at least requires Java 6.0","name":"3.2","archived":false,"released":true,"releaseDate":"2014-01-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12325850","id":"12325850","description":"Bug fix release for 3.2","name":"3.2.1","archived":false,"released":true,"releaseDate":"2014-01-05"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-04T17:19:20.248+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"While helping testing LANG-942 with JDK1.8 I always got three tests failing, while others had 2. After @britter fixed the issues related to JDK1.8, I continue getting errors with JDK1.8.\n\nI decided to vote for [lang] 3.2.1 and test the tag with JDK 1.8 and a few others. However, I'm getting errors with any JDK, 1.6, 1.7 and 1.8 (build 121). Always the same error:\n\nFailed tests: \n  DurationFormatUtilsTest.testEdgeDurations:467->assertEqualDuration:562->assertEqualDuration:575 expected:<7[7]> but was:<7[6]>\n\nI get the same error with JDK 1.6 and the tag 3.1\n\nSince the test is somewhat related to Time Zones (there are some Calendar's, TimeZone.getDefault(), etc), here's my locale and time zone:\n\nkinow@chuva:~/java/apache/commons-lang-31$ locale\nLANG=en_US.UTF-8\nLANGUAGE=en_US\nLC_CTYPE=\"en_US.UTF-8\"\nLC_NUMERIC=\"en_US.UTF-8\"\nLC_TIME=\"en_US.UTF-8\"\nLC_COLLATE=\"en_US.UTF-8\"\nLC_MONETARY=\"en_US.UTF-8\"\nLC_MESSAGES=\"en_US.UTF-8\"\nLC_PAPER=\"en_US.UTF-8\"\nLC_NAME=\"en_US.UTF-8\"\nLC_ADDRESS=\"en_US.UTF-8\"\nLC_TELEPHONE=\"en_US.UTF-8\"\nLC_MEASUREMENT=\"en_US.UTF-8\"\nLC_IDENTIFICATION=\"en_US.UTF-8\"\nLC_ALL=\n\nkinow@chuva:~/java/apache/commons-lang-31$ date\nSun Jan  5 21:23:05 BRST 2014\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"366684","customfield_12312823":null,"summary":"Test DurationFormatUtilsTest.testEdgeDuration fails in JDK 1.6, 1.7 and 1.8, BRST time zone","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Apache Maven 3.1.1 (0728685237757ffbf44136acec0402957f723d9a; 2013-09-17 12:22:22-0300)\nMaven home: /opt/java/apache-maven-3.1.1\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"3.11.0-14-generic\", arch: \"amd64\", family: \"unix\"\n\nJDK 1.6.0_27, JDK 1.7.0_25, JDK 1.7.0_25","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687374/comment/13862688","id":"13862688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Build (mvn clean test -e -X) fails for me in Ubuntu Linux 3.11.0-14-generic x86_64, Apache Maven 3.1.1 for:\n\n########################\n#     JDK 1.6.0_27     #\n########################\n\nApache Maven 3.1.1 (0728685237757ffbf44136acec0402957f723d9a; 2013-09-17 12:22:22-0300)\nMaven home: /opt/java/apache-maven-3.1.1\nJava version: 1.6.0_27, vendor: Sun Microsystems Inc.\nJava home: /usr/lib/jvm/java-6-openjdk-amd64/jre\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"3.11.0-14-generic\", arch: \"amd64\", family: \"unix\"\n[...]\n[...]\n[...]\n[...]\nResults :\n\nFailed tests: \n  DurationFormatUtilsTest.testEdgeDurations:467->assertEqualDuration:562->assertEqualDuration:575 expected:<7[7]> but was:<7[6]>\n\nTests run: 2392, Failures: 1, Errors: 0, Skipped: 4\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 52.186s\n[INFO] Finished at: Sun Jan 05 21:05:29 BRST 2014\n[INFO] Final Memory: 23M/262M\n[INFO] ------------------------------------------------------------------------\n\n########################\n#     JDK 1.7.0_25     #\n########################\n\nApache Maven 3.1.1 (0728685237757ffbf44136acec0402957f723d9a; 2013-09-17 12:22:22-0300)\nMaven home: /opt/java/apache-maven-3.1.1\nJava version: 1.7.0_25, vendor: Oracle Corporation\nJava home: /usr/lib/jvm/java-7-openjdk-amd64/jre\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"3.11.0-14-generic\", arch: \"amd64\", family: \"unix\"\n[...]\n[...]\n[...]\n[...]\nResults :\n\nFailed tests: \n  DurationFormatUtilsTest.testEdgeDurations:467->assertEqualDuration:562->assertEqualDuration:575 expected:<7[7]> but was:<7[6]>\n\nTests run: 2392, Failures: 1, Errors: 0, Skipped: 5\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 44.062s\n[INFO] Finished at: Sun Jan 05 21:10:30 BRST 2014\n[INFO] Final Memory: 24M/337M\n[INFO] -----------------------------------------------------------------------\n\n########################\n#     JDK 1.8.0b121     #\n########################\n\nApache Maven 3.1.1 (0728685237757ffbf44136acec0402957f723d9a; 2013-09-17 12:22:22-0300)\nMaven home: /opt/java/apache-maven-3.1.1\nJava version: 1.8.0-ea, vendor: Oracle Corporation\nJava home: /opt/java/jdk1.8.0/jre\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"3.11.0-14-generic\", arch: \"amd64\", family: \"unix\"\n[...]\n[...]\n[...]\n[...]\nResults :\n\nFailed tests: \n  DurationFormatUtilsTest.testEdgeDurations:467->assertEqualDuration:562->assertEqualDuration:575 expected:<7[7]> but was:<7[6]>\n\nTests run: 2392, Failures: 1, Errors: 0, Skipped: 5\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 57.890s\n[INFO] Finished at: Sun Jan 05 21:12:57 BRST 2014\n[INFO] Final Memory: 24M/168M\n[INFO] ----------------------------------------------------------------------\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-01-05T23:26:36.436+0000","updated":"2014-01-05T23:26:36.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687374/comment/13864230","id":"13864230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Not sure if it was intentional, but the test is using the first day of daylight saving time in Brazil in 2005 [1].\n\nWhen I run the code below, I get 1, instead of 0.\n\n{code}\nCalendar cal = Calendar.getInstance(TimeZone.getTimeZone(\"America/Sao_Paulo\"));\ncal.set(2005, 9, 16, 0, 0, 0);\nSystem.out.println(cal.get(Calendar.HOUR_OF_DAY));\n{code}\n\nSo in the testEdgeDurations test, with the America/Sao_Paulo time zone, it is comparing the difference in days between 16/10/2005 01:00:00 and 01/01/2006 00:00:00. While the expected result is 77, because of this 01 hour added, the result is 76 (you can try that in [2]).\n\nI fixed the issue locally, by adding the following line right after the testEdgeDurations method declaration:\n\n{code}\n// Since the test seems to expect the result to be timezone-agnostic\nTimeZone.setDefault(TimeZone.getTimeZone(\"UTC\"));\n{code}\n\nDoes this seem like a valid fix for this issue? Without this, DateFormatUtils gets America/Sao_Paulo from TimeZone.getDefault(), what causes the test to fail.\n\nCheers\n\n[1] http://pt.wikipedia.org/wiki/Anexo:Lista_de_per%C3%ADodos_em_que_vigorou_o_hor%C3%A1rio_de_ver%C3%A3o_no_Brasil\n[2] http://www.onlineconversion.com/days_between_advanced.htm","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-01-07T13:29:37.118+0000","updated":"2014-01-07T13:33:25.241+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687374/comment/13869029","id":"13869029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"body":"Setting this to 3.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"created":"2014-01-12T12:45:02.616+0000","updated":"2014-01-12T12:45:02.616+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687374/comment/13874716","id":"13874716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"body":"[~kinow] where do you set the TimeZone? In setUp()? Feel free to resolve this issue in trunk. I will make sure the fix doesn't break anything in my TimeZone and hopefully the others will check some additional time zones, when I roll out 3.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"created":"2014-01-17T12:30:01.860+0000","updated":"2014-01-17T12:30:01.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687374/comment/13876687","id":"13876687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"body":"Fixed in r1559802","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kinow","name":"kinow","key":"kinow","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kinow&avatarId=14743","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kinow&avatarId=14743","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kinow&avatarId=14743","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kinow&avatarId=14743"},"displayName":"Bruno P. Kinoshita","active":true,"timeZone":"Pacific/Auckland"},"created":"2014-01-20T18:45:56.311+0000","updated":"2014-01-20T18:45:56.311+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-943/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1r5in:"}}