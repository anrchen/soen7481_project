{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12342756","self":"https://issues.apache.org/jira/rest/api/2/issue/12342756","key":"LANG-100","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311702","id":"12311702","name":"2.2","archived":true,"released":true,"releaseDate":"2006-10-04"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-12-01T13:19:10.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Tue Jun 27 07:28:09 UTC 2006","customfield_12310420":"34056","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_18091831000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_19412345744","customfield_12312321":null,"resolutiondate":"2006-06-27T07:28:09.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-100/watchers","watchCount":0,"isWatching":false},"created":"2005-11-29T21:57:38.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311701","id":"12311701","description":"","name":"2.1","archived":true,"released":true,"releaseDate":"2005-06-13"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-02-06T23:47:14.743+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"timeoriginalestimate":null,"description":"Problem are surrogate pairs: \nE.g. RandomStringUtils.random(int) may create strings with a high surrogate not\nfollowed by a low surrogate character.\n\nWhen processing them, we get errors in string-conversion-functions later on.","customfield_10010":37690.0,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"74875","customfield_12312823":null,"summary":"[lang] RandomStringUtils.random() family of methods create invalid unicode sequences","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stefanhoehne%40fastmail.fm","name":"stefanhoehne@fastmail.fm","key":"stefanhoehne@fastmail.fm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stefan Höhne","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stefanhoehne%40fastmail.fm","name":"stefanhoehne@fastmail.fm","key":"stefanhoehne@fastmail.fm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stefan Höhne","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Operating System: All\nPlatform: All","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12342756/comment/12410969","id":"12410969","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ggregory%40seagullsw.com","name":"ggregory@seagullsw.com","key":"ggregory@seagullsw.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10453"},"displayName":"ggregory@seagullsw.com","active":false,"timeZone":"Etc/UTC"},"body":"Can you please provide a unit test case patch to demonstrate the issue? Thanks,\nGary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ggregory%40seagullsw.com","name":"ggregory@seagullsw.com","key":"ggregory@seagullsw.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10453","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10453","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10453","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10453"},"displayName":"ggregory@seagullsw.com","active":false,"timeZone":"Etc/UTC"},"created":"2005-12-01T13:19:10.000+0000","updated":"2005-12-01T13:19:10.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12342756/comment/12410970","id":"12410970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stefanhoehne%40fastmail.fm","name":"stefanhoehne@fastmail.fm","key":"stefanhoehne@fastmail.fm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stefan Höhne","active":true,"timeZone":"Etc/UTC"},"body":"Sorry, have never added a unit test patch. \n\nHere is a junit test case showing the problem. \n\n\t/**\n\t * Creates a human readable representation of any unicode character.\n\t * @param c - a unicode character\n\t * @return human readable representation for c\n\t */\n\tstatic public String makeStringFromChar(char c)\n\t{\n\t\t// dirty for getting the char code from a character\n\t\treturn Integer.toHexString((new Character(c)).hashCode());\n\t}\n\n\t/**\n\t * Checks if the string got by {@link RandomStringUtils#random(int)} \n\t * can be converted to UTF-8 and back without loss.\n\t * \n\t * @author stefanhoehne@fastmail.fm\n\t * @throws Exception\n\t */\n\tpublic void testRandom() throws Exception\n\t{\n\t\tfinal int size = 5000;\n\t\tfinal String encoding = \"UTF-8\";\n\t\tfinal String orig = RandomStringUtils.random(size);\n\t\tfinal byte[] bytes = orig.getBytes(encoding);\n\t\tfinal String copy = new String(bytes, encoding);\n\n\t\t// for a verbose compare:\n\t\tfor (int i=0; i<orig.length() && i<copy.length(); ++i)\n\t\t{\n\t\t\tchar o = orig.charAt(i);\n\t\t\tchar c = copy.charAt(i);\n\t\t\tassertEquals(\"differs at \" + i + \"(\" + makeStringFromChar(o) + \",\" +\nmakeStringFromChar(c) + \")\", o, c);\n\t\t}\n\t\t// compare length also\n\t\tassertEquals(orig.length(), copy.length());\n\t\t// just to be complete\n\t\tassertEquals(orig, copy);\n\t}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stefanhoehne%40fastmail.fm","name":"stefanhoehne@fastmail.fm","key":"stefanhoehne@fastmail.fm","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stefan Höhne","active":true,"timeZone":"Etc/UTC"},"created":"2005-12-06T05:35:21.000+0000","updated":"2005-12-06T05:35:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12342756/comment/12410971","id":"12410971","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"Test indeed fails. \n\nCodewise, the a start of 0 and an end of Integer.MAX_VALUE are used. Each time\naround the loop a random number is created and the following test is applied:\n\n            if ((letters && Character.isLetter(ch))\n                || (numbers && Character.isDigit(ch))\n                || (!letters && !numbers)) { \n\nIn this case, letters and numbers are false, so it passes quite happily (as it's\nnot a random restricted to letters or digits). \n\nSo we need to be adding another test here, whether the character is correct\nunicode for the high/low surrogate bit. Googling, it looks like high surrogates\nare on the range 55296 (D800) to 56191 (DB7F); and there are 'private use high\nsurrogates' from 56192 (DB80) to 56319 (DBFF). So if a random character exists\nwithin that range, the following character must be a low surrogate. \n\nLow surrogates are 56320 (DC00) to 57343 (DFFF). \n\nSo, dumb pseudo-code:\n\nif(char > 55296 && char < 56191)\n    count--\n    char[count] = 56320 + random(128)\n\nBut I don't get what the private high surrogates are, I can't find the 'low'\nalternative (not that I understand much of this). Was looking at this site: \nhttp://www.alanwood.net/unicode/private_use_high_surrogates.html\n\nAny thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2006-04-24T13:45:22.000+0000","updated":"2006-04-24T13:45:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12342756/comment/12417930","id":"12417930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"Fixed for high/low I believe, but private high get skipped currently.\n\nsvn ci -m \"Adding a test and a fix for LANG-100. This is a bug in which the randomly created String can some\ntimes be illegal unicode; because the code does not consider when relationships exist between characters. High and low surrogates are now dealt with, but I'm skipping private high surrogates because I can't find out what to do. Need to go plod very slowly through the spec. This site was very useful: http://www.alanwood.net/unicode/private_use_high_surrogates.html\" src/*/org/apache/commons/lang/Random*\n\nSending        src/java/org/apache/commons/lang/RandomStringUtils.java\nSending        src/test/org/apache/commons/lang/RandomStringUtilsTest.java\nTransmitting file data ..\nCommitted revision 417319.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2006-06-27T07:28:09.000+0000","updated":"2006-06-27T07:28:09.000+0000"}],"maxResults":4,"total":4,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-100/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d6s7:"}}