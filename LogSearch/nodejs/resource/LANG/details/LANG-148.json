{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12342547","self":"https://issues.apache.org/jira/rest/api/2/issue/12342547","key":"LANG-148","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311702","id":"12311702","name":"2.2","archived":true,"released":true,"releaseDate":"2006-10-04"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2005-09-10T18:37:30.000+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Sep 10 18:37:30 UTC 2005","customfield_12310420":"34067","customfield_12312320":null,"customfield_12310222":"6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_44474430514","customfield_12312321":null,"resolutiondate":"2009-12-16T08:50:32.211+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-148/watchers","watchCount":0,"isWatching":false},"created":"2005-09-10T05:46:47.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-12-16T08:50:32.211+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313203","id":"12313203","name":"lang.*"}],"timeoriginalestimate":null,"description":"I dont know how picky you are about performance, but I think it would be nice \nfor methods like this not to create new objects (StringBuffers) and copy over, \nif it doesnt need to (e.g. if what you are searching for is not in the \"text\" \nString).  Also, if the text is empty, we can return it right away.  And, my \nprofiler gets two StringBuffers and an arrayCopy here sometimes since we only \nallocate enough for the original String.  I think overall it is better to \nallocate a little more (+20%) for the StringBuffer to reduce this possibility \nand only have 1 StringBuffer to be garbage collected.  Feel free to pick and \nchoose from any of these ideas.  :)\n\npublic static String replace(String text, String repl, String with, int max) {\n\n\ncould be written as:\n\n  public static String replace(String text, String repl, String with, int max) \n{\n    if (isEmpty(text) || isEmpty(repl) || with == null || max == 0) {\n      return text;\n    }\n    int start = 0, end = text.indexOf(repl, start);\n    if (end == -1) {\n      return text;\n    }\n    //add a bit of padding so we reduce the StringBuffer extend capacity\n    StringBuffer buf = new StringBuffer(text.length() \n        + (text.length() < 20 ? 4 : text.length()/5));\n    while (end != -1) {\n      buf.append(text.substring(start, end)).append(with);\n      start = end + repl.length();\n\n      if (--max == 0) {\n        break;\n      }\n      end = text.indexOf(repl, start);\n    }\n    buf.append(text.substring(start));\n    return buf.toString();\n  }\n\n\nI tested it on the test cases in the javadoc and it worked fine.\n\nThanks!\nChris","customfield_10010":36583.0,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"74827","customfield_12312823":null,"summary":"[lang] Performance modifications on StringUtils.replace","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mchyzer%40yahoo.com","name":"mchyzer@yahoo.com","key":"mchyzer@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mchyzer%40yahoo.com","name":"mchyzer@yahoo.com","key":"mchyzer@yahoo.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Operating System: other\nPlatform: Other","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12342547/comment/12410385","id":"12410385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scolebourne%40joda.org","name":"scolebourne@joda.org","key":"scolebourne@joda.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Colebourne","active":true,"timeZone":"Etc/UTC"},"body":"Code changed, based on code below, but with different algorithm for sizing.\nPlease test this algorithm to see if it still helps with your performance issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scolebourne%40joda.org","name":"scolebourne@joda.org","key":"scolebourne@joda.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephen Colebourne","active":true,"timeZone":"Etc/UTC"},"created":"2005-09-10T18:37:30.000+0000","updated":"2005-09-10T18:37:30.000+0000"}],"maxResults":1,"total":1,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-148/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d6hj:"}}