{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12527474","self":"https://issues.apache.org/jira/rest/api/2/issue/12527474","key":"LANG-762","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317952","id":"12317952","description":"Bug fixes and new features, at least requires Java 6.0","name":"3.2","archived":false,"released":true,"releaseDate":"2014-01-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12312322":null,"customfield_12310220":"2011-10-22T01:59:57.320+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Mon Oct 21 19:51:56 UTC 2013","customfield_12310420":"88662","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_63509467566_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2013-10-21T19:51:56.187+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-762/watchers","watchCount":1,"isWatching":false},"created":"2011-10-17T18:20:48.708+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-21T19:51:56.254+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313198","id":"12313198","name":"lang.builder.*"}],"timeoriginalestimate":null,"description":"Moving discussion here from https://issues.apache.org/jira/browse/POOL-191 ConcurrentModificationException in GenericObjectPool LinkedList.\n\nIt is possible to get a {{ConcurrentModificationException}} in a {{LinkedList}} from a Commons Pool {{GenericObjectPool}}.\n\nThis happens when I call {{ReflectionToStringBuilder.toString(this)}} from a subclass of {{GenericObjectPool}}. My guess is that it would happen with just {{ReflectionToStringBuilder.toString(gop)}}. IOW, subclassing does not have anything to do with it I would venture.\n\nFor example, in this stack trace {{JmsSessionPool}} is a subclass of {{GenericObjectPool}}.\n\n{noformat}\njava.util.ConcurrentModificationException\nat java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:761)\nat java.util.LinkedList$ListItr.next(LinkedList.java:696)\nat java.util.AbstractCollection.toString(AbstractCollection.java:421)\nat java.lang.String.valueOf(String.java:2826)\nat java.lang.StringBuffer.append(StringBuffer.java:219)\nat org.apache.commons.lang3.builder.ToStringStyle.appendDetail(ToStringStyle.java:598)\nat org.apache.commons.lang3.builder.ToStringStyle.appendInternal(ToStringStyle.java:473)\nat org.apache.commons.lang3.builder.ToStringStyle.append(ToStringStyle.java:436)\nat org.apache.commons.lang3.builder.ToStringBuilder.append(ToStringBuilder.java:848)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.appendFieldsIn(ReflectionToStringBuilder.java:528)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:692)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:288)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:119)\nat com.seagullsw.appinterface.comm.jms.JmsSessionPool.toString(JmsSessionPool.java:120)\nat java.lang.String.valueOf(String.java:2826)\nat java.lang.StringBuffer.append(StringBuffer.java:219)\nat org.apache.commons.lang3.builder.ToStringStyle.appendDetail(ToStringStyle.java:586)\nat org.apache.commons.lang3.builder.ToStringStyle.appendInternal(ToStringStyle.java:550)\nat org.apache.commons.lang3.builder.ToStringStyle.append(ToStringStyle.java:436)\nat org.apache.commons.lang3.builder.ToStringBuilder.append(ToStringBuilder.java:848)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.appendFieldsIn(ReflectionToStringBuilder.java:528)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:689)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:288)\nat org.apache.commons.lang3.builder.ReflectionToStringBuilder.toString(ReflectionToStringBuilder.java:119)\nat com.seagullsw.appinterface.server.comm.BasicCommunicationManager.toString(BasicCommunicationManager.java:828)\nat com.seagullsw.appinterface.server.comm.BasicCommunicationManager.toString(BasicCommunicationManager.java:817)\nat java.lang.String.valueOf(String.java:2826)\nat java.lang.StringBuilder.append(StringBuilder.java:115)\nat com.seagullsw.appinterface.server.AisHelper.waitForCommuncationManagers(AisHelper.java:217)\nat com.seagullsw.appinterface.server.AisHelper.start(AisHelper.java:136)\nat com.seagullsw.appinterface.server.AisHelper.startFromResource(AisHelper.java:161)\nat com.seagullsw.appinterface.server.AbstractServerJunit4.startServer(AbstractServerJunit4.java:179)\nat com.seagullsw.appinterface.server.comm.jms.AbstractJmsRoundtripMaxConcurrencyTestCase.setUpOnce(AbstractJmsRoundtripMaxConcurrencyTestCase.java:141)\nat com.seagullsw.appinterface.server.comm.jms.ibmmq.JmsRoundtripMaxConcurrency032TestCase.setUpOnce(JmsRoundtripMaxConcurrency032TestCase.java:40)\n{noformat}\n\nWe should either: \n- Document ReflectionToStringBuilder and ToStringBuilder such that call sites use synchronized if the object passed in contains collections that are not thread-safe. F\n\nor example:\n{code:java}\n    @Override\n    public synchronized String toString() {\n        return ReflectionToStringBuilder.toString(this);\n    }\n{code}\n\n- Or have our code in ReflectionToStringBuilder and ToStringBuilder lock collections while they are being toString'd.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12500277","id":"12500277","filename":"patch-LANG762.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acumiskey","name":"acumiskey","key":"acumiskey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=acumiskey&avatarId=12352","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=acumiskey&avatarId=12352","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=acumiskey&avatarId=12352","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=acumiskey&avatarId=12352"},"displayName":"Adrian Cumiskey","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-22T01:59:57.252+0000","size":886,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12500277/patch-LANG762.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12500310","id":"12500310","filename":"ReflectionToStringBuilderConcurrencyTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=psteitz","name":"psteitz","key":"psteitz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Steitz","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-22T07:11:58.563+0000","size":3222,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12500310/ReflectionToStringBuilderConcurrencyTest.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"63018","customfield_12312823":null,"summary":"Handle or document ReflectionToStringBuilder and ToStringBuilder for collections that are not thread safe","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Apache Maven 3.0.3 (r1075438; 2011-02-28 12:31:09-0500)\nMaven home: C:\\Java\\apache-maven-3.0.3\\bin\\..\nJava version: 1.6.0_24, vendor: Sun Microsystems Inc.\nJava home: C:\\Program Files\\Java\\jdk1.6.0_24\\jre\nDefault locale: en_US, platform encoding: Cp1252\nOS name: \"windows 7\", version: \"6.1\", arch: \"amd64\", family: \"windows\"","customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13133221","id":"13133221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acumiskey","name":"acumiskey","key":"acumiskey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=acumiskey&avatarId=12352","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=acumiskey&avatarId=12352","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=acumiskey&avatarId=12352","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=acumiskey&avatarId=12352"},"displayName":"Adrian Cumiskey","active":true,"timeZone":"Etc/UTC"},"body":"I tried pretty hard to try and reproduce ConcurrentModificationException in a fairly elaborate multithreaded unit test (but alas failed...).\n\nI looked at the two approaches you proposed for fixing this issue.  I believe it is not correct to expect the ReflectionToStringBuilder caller to synchronize his toString() implementation.  \n\nI believe the best place for the guard is just prior to the object being appended by the StringBuffer.  I have provided a small patch that takes care of synchronizing any Collection or Map in ToStringStyle. \n\nCheers, Adrian.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acumiskey","name":"acumiskey","key":"acumiskey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=acumiskey&avatarId=12352","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=acumiskey&avatarId=12352","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=acumiskey&avatarId=12352","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=acumiskey&avatarId=12352"},"displayName":"Adrian Cumiskey","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-22T01:59:57.320+0000","updated":"2011-10-22T01:59:57.320+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13133236","id":"13133236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"body":"I'll have to provide my test case that shows the failure. I'm on vacation now so it might be a couple of days.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"created":"2011-10-22T03:11:08.877+0000","updated":"2011-10-22T03:11:08.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13133249","id":"13133249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acumiskey","name":"acumiskey","key":"acumiskey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=acumiskey&avatarId=12352","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=acumiskey&avatarId=12352","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=acumiskey&avatarId=12352","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=acumiskey&avatarId=12352"},"displayName":"Adrian Cumiskey","active":true,"timeZone":"Etc/UTC"},"body":"Hi Gary,\n\nNo problem.  That would be great if you are able to provide a test case which is able to reliably reproduce the failure on trunk.  It might be the following weekend before I get chance to revisit if the patch doesn't resolve the issue.  Enjoy your vacation! :-)\n\nCheers, Adrian.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=acumiskey","name":"acumiskey","key":"acumiskey","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=acumiskey&avatarId=12352","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=acumiskey&avatarId=12352","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=acumiskey&avatarId=12352","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=acumiskey&avatarId=12352"},"displayName":"Adrian Cumiskey","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-22T05:26:49.150+0000","updated":"2011-10-22T05:26:49.150+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13133286","id":"13133286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=psteitz","name":"psteitz","key":"psteitz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Steitz","active":true,"timeZone":"Etc/UTC"},"body":"Attaching a test that illustrates the problem, which I don't think is solvable by the [lang] code (so probably this class should not be committed, as it will never pass).\n\nThe problem is that when you circumvent a class' internal synchronization to protect fields, all bets are off in terms of data integrity or CoMod exceptions. This should be clearly documented - i.e., users should be warned that this class should not be used in concurrent applications, or at least fields protected by synchronization should be excluded.\n\nWhat is going on in the test case is that there are two different kinds of threads spawned concurrently - one kind uses the reflection back door opened by the builder to \"inspect\" an instance and the other kind mutates the instance using its synchronized methods.  Note that synchronizing the builder using the private field's monitor will not solve the problem (i.e., the first patch does not work) because what really needs to happen is that the access by the builder needs to be synchronized using the instance's monitor.  You could try to fix that by synchronizing on the instance, which would solve this example; but there is no guarantee that a class may not use its own internal locks, so there is no generic solution to this problem.\n\nMy recommendation is to just document the danger associated with using reflection to access private fields in the class javadoc.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=psteitz","name":"psteitz","key":"psteitz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Steitz","active":true,"timeZone":"Etc/UTC"},"created":"2011-10-22T07:11:58.706+0000","updated":"2011-10-22T07:11:58.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13147091","id":"13147091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"body":"I've added some unit tests, mostly @Ignore tests. I added Phil's test {{ReflectionToStringBuilderConcurrencyTest.java}} from 22/Oct/11 07:11 as {{ReflectionToStringBuilderMutateInspectConcurrencyTest}} because I already have a {{ReflectionToStringBuilderConcurrencyTest}} in there.\n\nThis should make it easier for people to experiment with suggestions and patches.\n\nFor example, the patch {{patch-LANG762.txt}} from 22/Oct/11 01:59 does not work for on my machine.\n\nThe test ReflectionToStringBuilderMutateInspectConcurrencyTest passes on my machine but I still @Ignored the test based on Phil's comments.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"created":"2011-11-09T15:17:55.987+0000","updated":"2011-11-09T15:17:55.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13147468","id":"13147468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=psteitz","name":"psteitz","key":"psteitz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Steitz","active":true,"timeZone":"Etc/UTC"},"body":"Looking at this again, I am pretty well convinced that [lang] is never going to be able to \"fix\" this issue.  Consider the case where a class uses its own private Lock instances to protect data members.  Unless you want to get into the byte code analysis business, you are not going to be able to pick this up or access the relevant locks.  Moreoever, even if you could discern and acquire the right locks, you might risk introducing deadlocks or liveness problems for the code, because the class may have lock acquisition / release order invariants that you don't know about.\n\nThe risks associated with using the ReflectionToStringBuilder to access fields protected by synchronization should be documented. I would suggest just adding something like the following to the class javadoc, after the sentence that reads \"This will fail under a security manager, unless the appropriate permissions are set up correctly\" add \"Using reflection to access private fields also circumvents any synchronization protection guarding access to private fields.  Fields that cannot safely be read at any time by toString should be excluded from the generated method, or synchronization consistent with the underlying class' lock management should be added around invocation of the method. Special care should be taken to avoid including non-threadsafe collection classes, as these classes may throw ConcurrentModificationException if modified while the toString method is executing.\"\n\nAbove is probably too long, but something like it should be added.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=psteitz","name":"psteitz","key":"psteitz","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Phil Steitz","active":true,"timeZone":"Etc/UTC"},"created":"2011-11-10T03:29:10.797+0000","updated":"2011-11-10T03:29:10.797+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13147513","id":"13147513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"body":"Better Javadocs: Committed revision 1200177.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=garydgregory","name":"garydgregory","key":"garydgregory","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=garydgregory&avatarId=16828","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=garydgregory&avatarId=16828","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=garydgregory&avatarId=16828","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=garydgregory&avatarId=16828"},"displayName":"Gary Gregory","active":true,"timeZone":"America/Denver"},"created":"2011-11-10T06:15:09.639+0000","updated":"2011-11-10T06:15:09.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12527474/comment/13801002","id":"13801002","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"Issue documented in 3.2, but no code change made. Reading through the conversation, consensus appears to me to be to make no code change to Lang.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-10-21T19:51:56.234+0000","updated":"2013-10-21T19:51:56.234+0000"}],"maxResults":8,"total":8,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-762/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b5lb:"}}