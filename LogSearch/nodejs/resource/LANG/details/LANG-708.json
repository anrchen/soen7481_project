{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12511349","self":"https://issues.apache.org/jira/rest/api/2/issue/12511349","key":"LANG-708","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317157","id":"12317157","description":"August release from 3.x","name":"3.0.1","archived":true,"released":true,"releaseDate":"2011-08-09"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-06-23T13:19:14.738+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Fri Jul 15 07:27:26 UTC 2011","customfield_12310420":"67975","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1869518318_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_14081880_*|*_4_*:*_1_*:*_50091","customfield_12312321":null,"resolutiondate":"2011-07-15T07:27:26.308+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-708/watchers","watchCount":0,"isWatching":false},"created":"2011-06-23T12:13:16.078+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-07-15T07:27:26.338+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313195","id":"12313195","name":"lang.text.translate.*"}],"timeoriginalestimate":null,"description":"Hello, I have a really big JSON string (generated from db) with unicode chars and I need to pass it though StringEscapeUtils.escapeEcmaScript(value). This string is generated and in most cases it works ok, but I have met a specific string (attached below) which is not correctly converted - few symbols (about 10) at the end of the string are cut-off (and actually they are not already unicode chars).\n\nthe original string ends with:\n \"geonameId\":6544329,\"valueCode\":\"\"}]\n\nand the produced string ends with:\n \\\"geonameId\\\":6544329,\\\"value\n\nSo Code\":\"\"}] part is missing and this does not allow to parse the result as JSON on the client side.\n\n\nI have tried to debug a bit with StringEscapeUtils.escapeEcmaScript source code and is seems that the problem is somewhere around here:\n\nCharSequenceTranslator.translate(...){\n...\n        int sz = Character.codePointCount(input, 0, input.length());\n        for (int i = 0; i < sz; i++) {\n            // consumed is the number of codepoints consumed\n            int consumed = translate(input, i, out);\n\n            if(consumed == 0) { \n                out.write( Character.toChars( Character.codePointAt(input, i) ) );\n            }\n...\n}\n\nIf I put breakpoint condition to stop in the loop when i==(sz-5), I can see that the last chars of \"valueCode\" literal are being added to the end of \"out\" stream, but the counter condition ends too early to reach the end of original input String.\n\nSo, it seems that somehow with the provided string either the sz value is calculated incorrectly or the processing loop did wrong counter adjustmes at some point.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12483595","id":"12483595","filename":"input.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-23T13:51:58.248+0000","size":6038,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12483595/input.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12483594","id":"12483594","filename":"Test.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-23T13:51:58.237+0000","size":1906,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12483594/Test.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"74667","customfield_12312823":null,"summary":"StringEscapeUtils.escapeEcmaScript from lang3 cuts off long unicode string","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12511349/comment/13053827","id":"13053827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"body":"It seems that StringEscapeUtils.escapeJavaScript(value) from 2 commons.lang 2.1 does not have this problem with same string.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-23T12:53:19.250+0000","updated":"2011-06-23T12:53:19.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12511349/comment/13053840","id":"13053840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"body":"Once you have created a JIRA issue, you can use More Actions / Attach Files to attach files.\n\nPlease could you do so with the test data? It's difficult to use as it is.\n\nThe issue text could then be editted to remove the inline data.\n\nThanks very much.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sebb%40apache.org","name":"sebb@apache.org","key":"sebb@apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebb","active":true,"timeZone":"Etc/GMT"},"created":"2011-06-23T13:19:14.738+0000","updated":"2011-06-23T13:19:14.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12511349/comment/13053861","id":"13053861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"body":"drop both files to same dir and run Test.java as main class - it would print result of conversion with 3.0 and 2.1 to system out - 3.0 will have described problem, 2.1 will not (both libs should be added as project deps).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=benderamp","name":"benderamp","key":"benderamp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"anton","active":true,"timeZone":"Etc/UTC"},"created":"2011-06-23T13:51:58.278+0000","updated":"2011-06-23T13:51:58.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12511349/comment/13065693","id":"13065693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbenson","name":"mbenson","key":"mbenson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Benson","active":true,"timeZone":"America/Chicago"},"body":"With LANG-720 fixed, lang3 trunk no longer cuts off the end of the string.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mbenson","name":"mbenson","key":"mbenson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matt Benson","active":true,"timeZone":"America/Chicago"},"created":"2011-07-15T03:31:54.384+0000","updated":"2011-07-15T03:31:54.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12511349/comment/13065747","id":"13065747","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"body":"Setting fix version to 3.0.1.\n\nSetting resolution to Fixed; I think we should treat this as a different bug entry to LANG-720, even if the same code change fixed it. It's a notably different symptom and worth calling out.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bayard","name":"bayard","key":"bayard","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Yandell","active":true,"timeZone":"America/Los_Angeles"},"created":"2011-07-15T07:27:26.317+0000","updated":"2011-07-15T07:27:26.317+0000"}],"maxResults":5,"total":5,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-708/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0d5hz:"}}