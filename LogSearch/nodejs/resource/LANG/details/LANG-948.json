{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12688219","self":"https://issues.apache.org/jira/rest/api/2/issue/12688219","key":"LANG-948","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310481","id":"12310481","key":"LANG","name":"Commons Lang","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310481&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310481&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310481&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310481&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10260","id":"10260","description":"Apache Commons components","name":"Commons"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326513","id":"12326513","description":"Feature and bugfix release","name":"3.4","archived":false,"released":true,"releaseDate":"2015-04-06"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-01-29T19:11:47.379+0000","customfield_12312520":null,"customfield_12312323":null,"customfield_12312521":"Sat Mar 14 13:11:27 UTC 2015","customfield_12310420":"367238","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_36985248768_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"resolutiondate":"2015-03-14T12:48:35.429+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312923":null,"customfield_12312326":null,"customfield_12312920":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312921":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-948/watchers","watchCount":3,"isWatching":false},"created":"2014-01-10T11:07:46.714+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317952","id":"12317952","description":"Bug fixes and new features, at least requires Java 6.0","name":"3.2","archived":false,"released":true,"releaseDate":"2014-01-01"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12325850","id":"12325850","description":"Bug fix release for 3.2","name":"3.2.1","archived":false,"released":true,"releaseDate":"2014-01-05"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-04-06T17:28:16.587+0000","customfield_12312335":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313194","id":"12313194","name":"lang.text.*"}],"timeoriginalestimate":null,"description":"Exception while trying to format a string containing escaped braces\n\n{code}\nException in thread \"main\" java.lang.IllegalArgumentException: Invalid format argument index at position 7: }\n\tat org.apache.commons.lang3.text.ExtendedMessageFormat.readArgumentIndex(ExtendedMessageFormat.java:357)\n\tat org.apache.commons.lang3.text.ExtendedMessageFormat.applyPattern(ExtendedMessageFormat.java:167)\n\tat org.apache.commons.lang3.text.ExtendedMessageFormat.<init>(ExtendedMessageFormat.java:128)\n\tat org.apache.commons.lang3.text.ExtendedMessageFormat.<init>(ExtendedMessageFormat.java:113)\n\tat test.TestExtendedMessageFormat.main(TestExtendedMessageFormat.java:16)\n{code}\n\nI will attach a source","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12622378","id":"12622378","filename":"TestExtendedMessageFormat.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=n.chieffo%40tecla.it","name":"n.chieffo@tecla.it","key":"n.chieffo@tecla.it","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolò Chieffo","active":true,"timeZone":"Europe/Berlin"},"created":"2014-01-10T11:08:51.678+0000","size":1129,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12622378/TestExtendedMessageFormat.java"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12622379","id":"12622379","filename":"TestExtendedMessageFormat2.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=n.chieffo%40tecla.it","name":"n.chieffo@tecla.it","key":"n.chieffo@tecla.it","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolò Chieffo","active":true,"timeZone":"Europe/Berlin"},"created":"2014-01-10T11:11:56.043+0000","size":1141,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12622379/TestExtendedMessageFormat2.java"}],"aggregatetimeestimate":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"367547","customfield_12312823":null,"summary":"Exception while using ExtendedMessageFormat and escaping braces","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=n.chieffo%40tecla.it","name":"n.chieffo@tecla.it","key":"n.chieffo@tecla.it","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolò Chieffo","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=n.chieffo%40tecla.it","name":"n.chieffo@tecla.it","key":"n.chieffo@tecla.it","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolò Chieffo","active":true,"timeZone":"Europe/Berlin"},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12313520":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688219/comment/13867721","id":"13867721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=n.chieffo%40tecla.it","name":"n.chieffo@tecla.it","key":"n.chieffo@tecla.it","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolò Chieffo","active":true,"timeZone":"Europe/Berlin"},"body":"another similar test case with the same exception","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=n.chieffo%40tecla.it","name":"n.chieffo@tecla.it","key":"n.chieffo@tecla.it","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nicolò Chieffo","active":true,"timeZone":"Europe/Berlin"},"created":"2014-01-10T11:11:56.049+0000","updated":"2014-01-10T11:11:56.049+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688219/comment/13885667","id":"13885667","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmjones500","name":"dmjones500","key":"dmjones500","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dmjones500&avatarId=31601","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dmjones500&avatarId=31601","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dmjones500&avatarId=31601","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dmjones500&avatarId=31601"},"displayName":"Duncan Jones","active":true,"timeZone":"Europe/London"},"body":"I think the problem lies with the {{appendQuotedString}} method, however I'm struggling to fix it because I'm not 100% sure what that method should be doing.\n\nI propose that we make that method static and package-private, so we can unit test it in isolation. (It probably should be static anyway, as it uses no instance fields). My confusion is about the desired effect of the {{escapingOn}} attribute. I'm assuming that when it's {{true}}, two single quotes next to each other are treated as an escaped single quote, and the resulting string pushed onto the buffer should have un-escaped quotes. Conversely, when it's {{false}}, two singles quotes are treated as a quoted string of zero length.\n\nFrom these assumptions, I've created this little unit test:\n\n{code:java}\n@Test\npublic void testAppendQuotedString() throws Exception {\n    assertEquals(\"'test'\", readFirstQuotedString(\"''test''123\", true));\n    assertEquals(\"'test'\", readFirstQuotedString(\"'test'123\", true));\n    assertEquals(\"\", readFirstQuotedString(\"''test''123\", false));\n}\n\nprivate static String readFirstQuotedString(String input, boolean escapingOn) {\n    StringBuilder builder = new StringBuilder();\n    ExtendedMessageFormat.appendQuotedString(input, new ParsePosition(0), builder, escapingOn);\n    return builder.toString();\n}\n{code}\n\nNote: these tests currently fail.\n\nIf someone can confirm (or correct) my understanding, I can fix the method and hopefully this bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dmjones500","name":"dmjones500","key":"dmjones500","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dmjones500&avatarId=31601","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dmjones500&avatarId=31601","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dmjones500&avatarId=31601","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dmjones500&avatarId=31601"},"displayName":"Duncan Jones","active":true,"timeZone":"Europe/London"},"created":"2014-01-29T19:11:47.379+0000","updated":"2014-01-29T19:11:47.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688219/comment/13886870","id":"13886870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"body":"If you have a fix that fixes the provided test cases and doesn't break any of the existing tests, I see no point not to apply it :) I'm okay with making methods static that do not access fields. Making methods package private for testability is also okay, if there is absolutely not other ways to test them (but in the end this often indicates a flawed design...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"created":"2014-01-30T18:26:26.845+0000","updated":"2014-01-30T18:26:26.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688219/comment/13967824","id":"13967824","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user Andrey-Khobnya opened a pull request:\n\n    https://github.com/apache/commons-lang/pull/19\n\n    Fix LANG-948\n\n    Hi all!\n    This is fix for bug LANG-948.\n    \n    Changes with explanations:\n    1) Method ```ExtendedMessageFormat.appendQuotedString()``` returned when finds first quote character. This is obviously wrong because quoted string start with quote character and method must consume whole quoted string. I added handling of first quote character at the beginning of method. Also, it doesn't make sense to handle escaped quotes because ```super.applyPattern(stripCustom.toString())``` will called below in ```applyPattern()```. Thus, last argument should be ```false``` when calling ```appendQuotedString()```.\n    \n    2) Quoted string must start with quote character in ```appendQuotedString()```. And at this moment method is used this way. I added assertion to check and document this.\n    \n    3) Thus, method ```appendQuotedString()``` is called with last argument always ```false```. It doesn't make sense to handle escaped quotes in ```appendQuotedString()``` because they will be handled in ```super.applyPattern()```. Thus, I deleted this parameter and code for handling escaped quotes.\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/Andrey-Khobnya/commons-lang fix-948\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/commons-lang/pull/19.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #19\n    \n----\ncommit 86e64df6ce7e879c5f608aa7276c251377574f56\nAuthor: Andrey Khobnya <andrey@khobnya.me>\nDate:   2014-04-13T12:36:07Z\n\n    Fix LANG-948\n\ncommit 0f9222d5cccbe27fbda5ab9b97b231162e4b089b\nAuthor: Andrey Khobnya <andrey@khobnya.me>\nDate:   2014-04-13T12:42:02Z\n\n    Add assertion in ExtendedMessageFormat.appendQuotedString() to check and\n    document proper usage\n\ncommit 4d372f3ce65087c8863332c74c2563a165d7aa12\nAuthor: Andrey Khobnya <andrey@khobnya.me>\nDate:   2014-04-13T12:49:28Z\n\n    It doesn't make sense to handle escaped quotes in\n    ExtendedMessageFormat.appendQuotedString() because they will be handled\n    in super.applyPattern()\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2014-04-13T14:07:00.952+0000","updated":"2014-04-13T14:07:00.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688219/comment/14361774","id":"14361774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"body":"{code}\n$ svn ci -m \"LANG-948: Exception while using ExtendedMessageFormat and escaping braces. This fixes #19 from github. Thanks to Andrey Khobnya.\"\nSending        src/changes/changes.xml\nSending        src/main/java/org/apache/commons/lang3/text/ExtendedMessageFormat.java\nSending        src/test/java/org/apache/commons/lang3/text/ExtendedMessageFormatTest.java\nTransmitting file data ...\nCommitted revision 1666679.\n{code}\n\nThank you!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=britter","name":"britter","key":"britter","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=britter&avatarId=18287","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=britter&avatarId=18287","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=britter&avatarId=18287","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=britter&avatarId=18287"},"displayName":"Benedikt Ritter","active":true,"timeZone":"Europe/Berlin"},"created":"2015-03-14T12:48:35.465+0000","updated":"2015-03-14T12:48:35.465+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12688219/comment/14361779","id":"14361779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/commons-lang/pull/19\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2015-03-14T13:11:27.072+0000","updated":"2015-03-14T13:11:27.072+0000"}],"maxResults":6,"total":6,"startAt":0},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LANG-948/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1raun:"}}